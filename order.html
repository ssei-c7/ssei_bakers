<!-- order.html (updated) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SSEI Bakers — Order</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg1:#021026;
      --bg2:#071126;
      --accent1:#00d2ff;
      --accent2:#6f5bff;
      --glass:rgba(255,255,255,0.02);
      --muted:#9db0c6;
      --card-w:720px;
      --summary-w:360px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:
      radial-gradient(900px 420px at 10% 12%, rgba(111,91,255,0.05), transparent 10%),
      radial-gradient(900px 420px at 92% 88%, rgba(0,210,255,0.04), transparent 10%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
      color:#eaf6ff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      -webkit-font-feature-settings: "liga" 1;}
    /* particles canvas */
    #particles{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:0.66}

    .wrap{position:relative;z-index:10;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:28px 20px;}
    .panel{
      width: min(1100px, calc(100% - 48px));
      border-radius:16px;
      padding:18px;
      display:flex;
      gap:18px;
      align-items:flex-start;
      justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      box-shadow:0 14px 80px rgba(2,6,23,0.75);
      backdrop-filter: blur(10px);
    }

    .main{
      width: calc(100% - var(--summary-w) - 18px);
      min-width: 320px;
      max-width: calc(var(--card-w));
      background: var(--glass);
      border-radius:12px;
      padding:14px;
      border:1px solid rgba(255,255,255,0.02);
      overflow:hidden;
      position:relative;
    }

    /* ensure summary stays in view and does not overflow page */
    .summary{
      width: var(--summary-w);
      position:sticky;
      top:28px;
      height: calc(100vh - 56px);
      align-self:flex-start;
      padding:14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));
      box-shadow: 0 10px 40px rgba(2,6,23,0.6);
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      will-change:transform,opacity;
      transition: box-shadow .18s ease, transform .18s ease;
    }

    .summary.scroll-shine{
      box-shadow: 0 18px 60px rgba(111,91,255,0.12);
      transform: translateY(-4px);
    }

    .top{display:flex;align-items:center;gap:14px}
    .logo{width:84px;height:84px;border-radius:12px;overflow:hidden;flex-shrink:0}
    .logo img{width:100%;height:100%;object-fit:contain}
    .title h1{margin:0;font-size:20px}
    .title p{margin:2px 0 0;font-size:13px;color:var(--muted)}

    label{display:block;margin:8px 0;color:#dfeeff}
    .inline{display:flex;gap:10px;align-items:center}
    select,input[type="radio"]{width:100%;padding:10px;border-radius:8px;border:0;background:rgba(0,0,0,0.32);color:inherit}
    input[type="checkbox"]{transform:scale(1.05);margin-right:8px}
    .btn {margin-top:14px;padding:12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#071018;box-shadow:0 10px 36px rgba(0,210,255,0.08);transition:transform .12s ease, box-shadow .12s ease}
    .btn:hover{transform:translateY(-5px);box-shadow:0 22px 60px rgba(111,91,255,0.14)}

    /* product grid */
    .products{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:6px}
    .product{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);transition:transform .18s ease, box-shadow .18s ease; will-change:transform}
    .product:hover{transform:translateY(-6px);box-shadow:0 14px 50px rgba(0,0,0,0.55)}
    .product h4{margin:0;font-size:15px}
    .priceTag{font-weight:700;color:#bff}
    .qty{width:62px;padding:8px;border-radius:8px;border:0;background:rgba(0,0,0,0.32);color:inherit}

    .promo{display:flex;gap:8px;margin-top:8px}
    .promo input{flex:1;padding:10px;border-radius:8px;border:0;background:rgba(0,0,0,0.32);color:inherit}

    .line{display:flex;justify-content:space-between;color:var(--muted);margin:8px 0}
    .price {font-size:18px;font-weight:700;color:#aef;}

    /* animated entries (will animate when they enter viewport) */
    .animate {
      opacity:0; transform: translateY(10px) scale(.995);
      transition: opacity .42s cubic-bezier(.2,.9,.2,1), transform .42s cubic-bezier(.2,.9,.2,1);
    }
    .animate.in-view { opacity:1; transform:none; }

    /* helpful simple feature list inside summary (simple points) */
    .features{margin-top:12px;color:var(--muted);font-size:14px}
    .features li{margin:8px 0;line-height:1.25}

    /* small responsive tweaks */
    @media (max-width:980px){
      .panel{flex-direction:column;align-items:stretch}
      .main{width:100%}
      .summary{position:relative;top:auto;height:auto;width:100%}
    }
    @media (max-width:520px){
      .products{grid-template-columns:1fr}
    }

    /* custom cursor visuals (improved) */
    .cursor, .cursor-f { position:fixed; pointer-events:none; z-index:9999; mix-blend-mode:screen; transform:translate(-50%,-50%); transition:transform .12s ease, opacity .12s ease; }
    .cursor{width:10px;height:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));border-radius:50%;box-shadow:0 0 18px rgba(0,0,0,0.5);opacity:0.98}
    .cursor-f{width:36px;height:36px;border-radius:50%;background:transparent;border:1px solid rgba(255,255,255,0.05);box-shadow:0 6px 26px rgba(111,91,255,0.06);opacity:0.95}
    .cursor-hover { transform: scale(1.9); opacity: 0.95; }
    .cursorF-hover { transform: scale(1.25); opacity: 0.98; }

    /* small shiny overlay at right edge to keep "white/glow" visible when scrolling */
    .main::after{
      content:""; position:absolute; right:0; top:0; bottom:0; width:28px;
      background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
      pointer-events:none; mix-blend-mode:overlay;
      transition:opacity .18s ease;
    }
    .main.scrolled::after{ opacity:0.9; }
  </style>
</head>
<body>
  <canvas id="particles"></canvas>
  <div class="cursor" id="cursor"></div>
  <div class="cursor-f" id="cursorF"></div>

  <div class="wrap">
    <div class="panel" role="main" aria-label="Order form">
      <section class="main" id="mainColumn" aria-labelledby="orderTitle">
        <div class="top" style="align-items:center;gap:12px;margin-bottom:6px">
          <div class="logo"><img src="assets/ssei_logo.png" alt="SSEI logo"></div>
          <div class="title"><h1 id="orderTitle">SSEI Bakers</h1><p class="muted" style="margin:0">Handmade cakes • Pizza • Fries • Drinks</p></div>
        </div>

        <div id="orderFormArea" class="animate">
          <div style="font-size:13px;color:var(--muted);margin-bottom:10px">Account: <span id="bankMasked">—</span></div>

          <form id="orderForm" onsubmit="return submitOrder(event)">
            <label>Delivery Option
              <div class="inline" style="margin-top:8px">
                <label style="width:100%"><input type="radio" name="delivery" value="Home Delivery" required> Home Delivery</label>
                <label style="width:100%"><input type="radio" name="delivery" value="Self Collection"> Self Collection</label>
              </div>
            </label>

            <label>Choose Cake Size (optional)
              <select id="cakeSize">
                <option value="">-- No cake --</option>
                <option value="Small" data-price="10">Small — 6" ($10)</option>
                <option value="Medium" data-price="20">Medium — 8" ($20)</option>
                <option value="Large" data-price="30">Large — 10" ($30)</option>
              </select>
            </label>

            <label style="margin-top:8px"><strong>Select additional items</strong></label>
            <div class="products" id="productsGrid">
              <div class="product animate" data-animate>
                <div><h4>Pepperoni Pizza</h4><div class="tip" style="color:var(--muted)">Large 10"</div></div>
                <div style="text-align:right">
                  <div class="priceTag">$15</div>
                  <input class="qty" data-name="Pepperoni Pizza" data-price="15" type="number" min="0" value="0">
                </div>
              </div>

              <div class="product animate" data-animate>
                <div><h4>Fries (Large)</h4><div class="tip" style="color:var(--muted)">Crispy salted</div></div>
                <div style="text-align:right">
                  <div class="priceTag">$6</div>
                  <input class="qty" data-name="Fries" data-price="6" type="number" min="0" value="0">
                </div>
              </div>

              <div class="product animate" data-animate>
                <div><h4>Soft Drink</h4><div class="tip" style="color:var(--muted)">330ml can</div></div>
                <div style="text-align:right">
                  <div class="priceTag">$2</div>
                  <input class="qty" data-name="Soft Drink" data-price="2" type="number" min="0" value="0">
                </div>
              </div>

              <div class="product animate" data-animate>
                <div><h4>Mini Cupcakes (4)</h4><div class="tip" style="color:var(--muted)">Assorted</div></div>
                <div style="text-align:right">
                  <div class="priceTag">$8</div>
                  <input class="qty" data-name="Mini Cupcakes" data-price="8" type="number" min="0" value="0">
                </div>
              </div>
            </div>

            <label style="margin-top:12px">Promo code (optional)
              <div class="promo">
                <input id="promo" placeholder="Enter code (WELCOME10)">
                <button type="button" class="btn" onclick="applyPromo()" style="padding:8px 12px;border-radius:8px">Apply</button>
              </div>
              <div id="promoMsg" class="tip" style="margin-top:8px;color:var(--muted)"></div>
            </label>

            <label style="margin-top:10px">Extras
              <div class="inline" style="margin-top:6px">
                <label><input type="checkbox" id="extraCandles" data-price="2"> Candles ($2)</label>
                <label><input type="checkbox" id="extraBalloons" data-price="3"> Balloons ($3)</label>
                <label style="margin-left:8px"><input type="checkbox" id="giftWrap" data-price="4"> Gift wrap ($4)</label>
              </div>
            </label>

            <label style="margin-top:12px">Special Note (optional)
              <input type="text" id="note" placeholder="E.g. 'Happy Birthday!'" style="padding:10px;border-radius:8px;border:0;background:rgba(0,0,0,0.32);color:inherit;width:100%;margin-top:8px">
            </label>

            <button class="btn" type="submit" id="placeBtn">Pay & Place Order</button>
          </form>
        </div>
      </section>

      <aside class="summary" id="summaryColumn" aria-label="Order summary">
        <h3 style="margin:0 0 8px 0">Order Summary</h3>
        <div class="line"><span>Items</span><span id="itemsPrice" class="price">$0</span></div>
        <div class="line"><span>Extras</span><span id="extrasPrice" class="price">$0</span></div>
        <div class="line"><span>Delivery</span><span id="deliveryPrice" class="price">$0</span></div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:8px 0">
        <div class="line" style="font-size:18px;font-weight:700"><span>Total</span><span id="totalPrice">$0</span></div>

        <div style="margin-top:12px">
          <strong style="display:block;margin-bottom:6px">Simple Features (short points)</strong>
          <ul class="features" id="featureList">
            <!-- Will be populated by JS for clarity and easy editing -->
          </ul>
        </div>

        <!-- animated receipt & quick actions -->
        <div style="margin-top:14px;display:flex;gap:8px">
          <button class="btn" id="downloadReceipt" style="flex:1;padding:10px">Download Receipt</button>
          <button class="btn" id="saveFavorite" style="flex:1;padding:10px;background:linear-gradient(90deg,var(--accent2),var(--accent1))">Save</button>
        </div>

        <div style="margin-top:12px;color:var(--muted);font-size:13px">
          Note: Summary is sticky and responsive. It will remain visible while you browse the order list.
        </div>
      </aside>
    </div>
  </div>

  <script>
    /* ---- Part 1: particles (kept lightweight) ---- */
    const can = document.getElementById('particles'), ctx = can.getContext('2d');
    let W = can.width = innerWidth, H = can.height = innerHeight;
    const dots = [];
    for (let i = 0; i < 90; i++) dots.push({ x: Math.random()*W, y: Math.random()*H, r: 0.8 + Math.random()*1.8, vx: (Math.random()-0.5)*0.25, vy: (Math.random()-0.5)*0.25, a: 0.05 + Math.random()*0.45 });
    function drawLoop(){
      ctx.clearRect(0,0,W,H);
      for (const d of dots){
        d.x += d.vx; d.y += d.vy;
        if (d.x < -10 || d.x > W+10) d.vx *= -1;
        if (d.y < -10 || d.y > H+10) d.vy *= -1;
        ctx.beginPath();
        ctx.fillStyle = 'rgba(0,210,255,' + d.a + ')';
        ctx.arc(d.x, d.y, d.r, 0, Math.PI*2);
        ctx.fill();
      }
      requestAnimationFrame(drawLoop);
    }
    drawLoop();
    addEventListener('resize', ()=>{ W = can.width = innerWidth; H = can.height = innerHeight; });

    /* ---- Part 2: custom cursor (improved) ---- */
    const cursor = document.getElementById('cursor'), cursorF = document.getElementById('cursorF');
    let mx = innerWidth/2, my = innerHeight/2, fx = mx, fy = my;
    window.addEventListener('mousemove', (e) => { mx = e.clientX; my = e.clientY; cursor.style.left = mx + 'px'; cursor.style.top = my + 'px'; });
    function followLoop(){ fx += (mx - fx) * 0.18; fy += (my - fy) * 0.18; cursorF.style.left = fx + 'px'; cursorF.style.top = fy + 'px'; requestAnimationFrame(followLoop); }
    followLoop();

    // enlarge on interactive hover
    document.body.addEventListener('pointerover', (e) => {
      if (e.target.closest('button, input, select, .product, .qty, .btn')) {
        cursor.classList.add('cursor-hover'); cursorF.classList.add('cursorF-hover');
      }
    });
    document.body.addEventListener('pointerout', (e) => {
      if (e.target.closest('button, input, select, .product, .qty, .btn')) {
        cursor.classList.remove('cursor-hover'); cursorF.classList.remove('cursorF-hover');
      }
    });

    /* tiny click particles for delight */
    document.addEventListener('click', (e) => {
      const px = document.createElement('div');
      px.style.position = 'fixed';
      px.style.left = (e.clientX - 6) + 'px';
      px.style.top = (e.clientY - 6) + 'px';
      px.style.width = '12px'; px.style.height = '12px'; px.style.borderRadius = '50%';
      px.style.background = 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(123,47,247,0.9))';
      px.style.pointerEvents = 'none'; px.style.zIndex = 10000; px.style.opacity = '1';
      px.style.transform = 'scale(0.6)';
      px.style.transition = 'transform .6s ease, opacity .6s ease';
      document.body.appendChild(px);
      requestAnimationFrame(()=> { px.style.transform = 'scale(2.8)'; px.style.opacity = '0'; });
      setTimeout(()=> px.remove(), 620);
    });

    /* ---- Part 3: data & pricing logic ---- */
    // load bank mask
    const bankMasked = document.getElementById('bankMasked');
    const bankNum = localStorage.getItem('ssei_bank_number') || '';
    if (!bankNum) {
      bankMasked.textContent = 'Not set — redirecting to Bank Page';
      setTimeout(()=> location.href = 'index.html', 240);
    } else {
      const m = bankNum.length>6 ? bankNum.slice(0,2)+'••••••'+bankNum.slice(-2) : bankNum.replace(/.(?=.{2})/g,'•');
      bankMasked.textContent = m;
    }

    const cakeSel = document.getElementById('cakeSize');
    const qtys = Array.from(document.querySelectorAll('.qty'));
    const extraC = document.getElementById('extraCandles'), extraB = document.getElementById('extraBalloons'), giftWrap = document.getElementById('giftWrap');
    const itemsPriceEl = document.getElementById('itemsPrice'), extrasPriceEl = document.getElementById('extrasPrice'), deliveryPriceEl = document.getElementById('deliveryPrice'), totalPriceEl = document.getElementById('totalPrice');

    let promoDiscount = 0;
    function recalc(){
      let items = 0;
      if (cakeSel.selectedOptions[0]) items += Number(cakeSel.selectedOptions[0].dataset.price || 0);
      qtys.forEach(q => { items += Number(q.value || 0) * Number(q.dataset.price || 0); });
      let extras = 0;
      if (extraC.checked) extras += Number(extraC.dataset.price || 0);
      if (extraB.checked) extras += Number(extraB.dataset.price || 0);
      if (giftWrap && giftWrap.checked) extras += Number(giftWrap.dataset.price || 0);
      const delivery = document.querySelector('input[name="delivery"]:checked')?.value === 'Home Delivery' ? 5 : 0;
      let total = items + extras + delivery;
      if (promoDiscount) total = Math.max(0, total - promoDiscount);
      itemsPriceEl.textContent = '$' + items;
      extrasPriceEl.textContent = '$' + extras;
      deliveryPriceEl.textContent = '$' + delivery;
      totalPriceEl.textContent = '$' + total;
      return total;
    }
    cakeSel.addEventListener('change', recalc);
    qtys.forEach(q => q.addEventListener('input', recalc));
    [extraC, extraB, giftWrap].forEach(i => i && i.addEventListener('change', recalc));
    document.querySelectorAll('input[name="delivery"]').forEach(i => i.addEventListener('change', recalc));
    recalc();

    function applyPromo(){
      const code = (document.getElementById('promo').value || '').trim().toUpperCase();
      const promoMsg = document.getElementById('promoMsg');
      if (!code) { promoDiscount = 0; promoMsg.textContent = 'No code entered'; recalc(); return; }
      if (code === 'WELCOME10') { promoDiscount = 10; promoMsg.textContent = 'Applied: $10 off'; }
      else if (code === 'SAVE5') { promoDiscount = 5; promoMsg.textContent = 'Applied: $5 off'; }
      else { promoDiscount = 0; promoMsg.textContent = 'Invalid code'; }
      recalc();
    }

    function submitOrder(e){
      e.preventDefault();
      const delivery = document.querySelector('input[name="delivery"]:checked')?.value;
      if (!delivery) { alert('Please choose a delivery option'); return false; }
      // collect items
      const items = [];
      if (cakeSel.value) items.push({ name: cakeSel.value + ' cake', price: Number(cakeSel.selectedOptions[0].dataset.price || 0), qty: 1 });
      qtys.forEach(q => {
        const qty = Number(q.value || 0);
        if (qty > 0) items.push({ name: q.dataset.name, price: Number(q.dataset.price), qty });
      });
      if (items.length === 0){ alert('Please select at least one item.'); return false; }
      const extras = [];
      if (extraC.checked) extras.push('Candles');
      if (extraB.checked) extras.push('Balloons');
      if (giftWrap && giftWrap.checked) extras.push('Gift wrap');
      const total = recalc();
      const order = { items, extras, delivery, total, bank_mask: bankMasked.textContent, ts: Date.now() };
      localStorage.setItem('ssei_pending_order', JSON.stringify(order));
      const btn = document.getElementById('placeBtn'); btn.disabled = true; btn.textContent = 'Processing...';
      setTimeout(()=> location.href = 'confirm.html', 420);
      return false;
    }

    /* ---- Part 4: make UI animate when elements enter viewport ---- */
    const observer = new IntersectionObserver((entries)=> {
      entries.forEach(en => {
        if (en.isIntersecting) en.target.classList.add('in-view');
      });
    }, { threshold: 0.12 });
    document.querySelectorAll('[data-animate], .animate').forEach(el => observer.observe(el));

    /* ---- Part 5: summary scroll shine + keep white/glow visible when scrolling ---- */
    const summary = document.getElementById('summaryColumn');
    let scrollTimer = null;
    document.querySelector('.main').addEventListener('scroll', () => {
      summary.classList.add('scroll-shine');
      document.getElementById('mainColumn').classList.add('scrolled');
      if (scrollTimer) clearTimeout(scrollTimer);
      scrollTimer = setTimeout(() => { summary.classList.remove('scroll-shine'); document.getElementById('mainColumn').classList.remove('scrolled'); }, 600);
    }, { passive: true });

    // Also detect window scroll to show shine quickly
    window.addEventListener('scroll', () => {
      summary.classList.add('scroll-shine');
      if (scrollTimer) clearTimeout(scrollTimer);
      scrollTimer = setTimeout(()=> summary.classList.remove('scroll-shine'), 550);
    }, { passive: true });

    /* ---- Part 6: feature list (simple points) ---- */
    const featureList = [
      "Live price calculator (updates instantly)",
      "Animated downloadable receipt",
      "Realtime ETA & order tracking",
      "Loyalty points & instant rewards",
      "Save favourite orders & one-click reorder",
      // five additional surprises requested
      "AI cake preview (mock) for theme selection",
      "Schedule delivery with reminder SMS",
      "Express same-day delivery option",
      "One-tap reorder from history",
      "Animated UI feedback & micro-interactions"
    ];
    const featuresEl = document.getElementById('featureList');
    featureList.forEach(f => {
      const li = document.createElement('li'); li.textContent = f; featuresEl.appendChild(li);
    });

    /* ---- Part 7: receipt download action (animated) ---- */
    document.getElementById('downloadReceipt').addEventListener('click', ()=>{
      const order = JSON.parse(localStorage.getItem('ssei_pending_order') || 'null');
      if (!order) return alert('No order to download.');
      // create animated receipt (simple text file)
      let content = `SSEI Bakers — Receipt\nOrder at ${new Date(order.ts).toLocaleString()}\n\n`;
      order.items.forEach(it => content += `${it.qty} x ${it.name} — $${(it.price*it.qty).toFixed(2)}\n`);
      content += `\nExtras: ${order.extras.join(', ') || 'None'}\nDelivery: ${order.delivery}\nTotal: $${order.total}\n`;
      const blob = new Blob([content], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `SSEI_receipt_${Date.now()}.txt`; a.style.display='none';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      // small visual pulse
      summary.style.transform = 'scale(0.996)'; summary.style.boxShadow = '0 20px 80px rgba(111,91,255,0.12)';
      setTimeout(()=> { summary.style.transform=''; summary.style.boxShadow=''; }, 420);
    });

    /* ---- Part 8: accessibility & fix for select/options visibility (some browsers) ---- */
    // Ensure option text is readable - no extra script needed; CSS already sets colors for options.

    // expose recalc for debugging
    window._recalc = recalc;
  </script>
</body>
</html>
